#!/bin/sh

readonly STYLESHEET="$HOME/.pandoc/github.css"

usage(){
cat <<-EOF	
	markdown previewer
	usage: mdp <filename> [keep temp]
EOF

exit 1
}


main(){
	[ "$*" == '' ] && usage
	
	local filename=$1; shift
	local keep=$1; shift

	local base="$(basename $filename .md)"
	local hash="$(echo "$(gdate +%s%N) $base" | gsha1sum | cut -c -8)"	
	local outfile="$hash-$base.html"
	
	pandoc "$filename"  \
		-o "$outfile"   \
		-c "$STYLESHEET"\
		--mathjax
	
	open "$outfile"

	if [ "$keep" = '' ]; then
		read -p "rm $outfile, press any key..." -n 1 -s
		rm "$outfile"
		echo
	fi

}

main $*
